/*!
 * timbre.soundfont.js
 * http://skratchdot.com/projects/timbre.soundfont.js/
 *
 * Copyright (c) 2013 skratchdot
 * Licensed under the MIT license.
 */
!function(){"use strict";var a,b,c={},d=1e3,e="https://free-midi.googlecode.com/git/channel/0/instrument/{instrument}/{note}.js?_callback=soundfont",f="gm",g=0,h=0,i=64,j=!0,k={};a=function(a){k.hasOwnProperty(f)||(k[f]={}),k[f].hasOwnProperty(g)||(k[f][g]={}),k[f][g].hasOwnProperty(h)||(k[f][g][h]={}),k[f][g][h].hasOwnProperty(i)||(k[f][g][h][i]={}),k[f][g][h][i].hasOwnProperty(a)||(k[f][g][h][i][a]={sample:null,isLoading:!1,loadTime:(new Date).getTime(),callbacks:[]})},b=function(b,l){var m,n;if(a(b),m=k[f][g][h][i][b],null!==m.sample)l(m.sample,!0);else if(m.isLoading&&(new Date).getTime()-m.loadTime<d)m.callbacks.push(l);else{m.isLoading=!0;try{n=e.replace("{name}",f,"gi").replace("{channel}",g,"gi").replace("{instrument}",h,"gi").replace("{length}",i,"gi").replace("{note}",b,"gi"),timbre("audio"+(j?".jsonp":"")).loadthis(n,function(){var a,d;for(m.sample=this,a=0;a<m.callbacks.length;a++)d=m.callbacks[a],"function"==typeof d&&d(m.sample,!1);m.callbacks=[],m.isLoading=!1,l(m.sample,!1),c.onLoad(m.sample,b)},function(){throw new Error('T("audio").loadthis() error.')}).on("ended",function(){this.pause()})}catch(o){m.isLoading=!1,m.sample=null,m.callbacks.push(l),c.onError(o,b)}}},c.emptyCache=function(){k={}},c.setUrlTemplate=function(a){c.emptyCache(),e=a},c.setName=function(a){f=a},c.setChannel=function(a){g=a},c.setInstrument=function(a){h=a},c.setLength=function(a){i=a},c.setJsonp=function(a){j=a===!0?!0:!1},c.preload=function(a){var c,d=function(){};for(c=0;c<a.length;c++)b(a[c],d)},c.play=function(a,c,d){c=c===!1?!1:!0,d="object"==typeof d?d:{},b(a,function(a,b){(b||c)&&a.set(d).play().bang()})},c.onError=function(){},c.onLoad=function(){},timbre&&timbre.modules&&timbre.modules.Decoder&&timbre.modules.Decoder.mp3_decode&&(timbre.soundfont=c)}();